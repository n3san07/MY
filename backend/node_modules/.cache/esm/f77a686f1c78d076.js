let con;_1c7‍.x([["getCustomers",()=>getCustomers],["getIsDeleted",()=>getIsDeleted],["removeCustomer",()=>removeCustomer],["DropCustomer",()=>DropCustomer],["addCustomer",()=>addCustomer],["editCustomer",()=>editCustomer],["Restore",()=>Restore],["getTask",()=>getTask],["addTask",()=>addTask],["changeTaskStatus",()=>changeTaskStatus],["changeTaskLevel",()=>changeTaskLevel],["restoreTask",()=>restoreTask]]);_1c7‍.w("../sqlConnect",[["con",["con"],function(v){con=v}]]);

       function getCustomers(req, res) {
  con.query(
    "SELECT * FROM `customers` WHERE `isDeleted` = ?",
    [0],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      res.send(result);
    }
  );
}

       function getIsDeleted(req, res) {
  con.query(
    "SELECT * FROM `customers` WHERE `isDeleted` = ?",
    [1],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      res.send(result);
    }
  );
}

       function removeCustomer(req, res) {
  con.query(
    "UPDATE `customers` SET `isDeleted` = 1 WHERE `id` = ?",
    [req.params.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      res.send();
    }
  );
}
       function DropCustomer(req, res) {
  con.query(
    "DELETE FROM `customers` WHERE `id` = ?",
    [req.params.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      res.send();
    }
  );
}
       function addCustomer(req, res) {
  con.query(
    "INSERT INTO `customers`(`FirstName`, `LastName`, `email`, `phone`, `state`, `country`, `city`, `street`, `housenumber`, `Zip`, `info`, `createdby`,`gender`) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)",
    [
      req.body.FirstName,
      req.body.LastName,
      req.body.email,
      req.body.phone,
      req.body.state,
      req.body.country,
      req.body.city,
      req.body.street,
      req.body.housenumber,
      req.body.Zip,
      req.body.info,
      req.body.createdby,
      req.body.gender,
    ],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      con.query(
        "SELECT * FROM `customers` WHERE `id` = ?",
        [result.insertId],
        (err, result) => {
          if (err) {
            _1c7‍.g.console.log(err);
          }
          res.send(result[0]);
        }
      );
    }
  );
}
       function editCustomer(req, res) {
  con.query(
    "UPDATE `customers` SET `FirstName` = ?,`LastName` = ?,`email` = ?,`phone` = ?,`state` = ?,`country` = ?,`city` = ?,`street` = ?, `housenumber` = ?, `Zip` = ?, `info` = ?, `gender` = ? WHERE `id` = ?",
    [
      req.body.FirstName,
      req.body.LastName,
      req.body.email,
      req.body.phone,
      req.body.state,
      req.body.country,
      req.body.city,
      req.body.street,
      req.body.housenumber,
      req.body.Zip,
      req.body.info,
      req.body.gender,
      req.body.id,
    ],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      res.send();
    }
  );
}
       function Restore(req, res) {
  con.query(
    "UPDATE `customers` SET  `isDeleted` = 0 WHERE `id` = ?",
    [
      req.params.id,
    ],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }
      res.send();
    }
  );
}

       function getTask(req, res) {
  con.query(
    "SELECT * FROM `tasks` WHERE `id` = ? AND `userId` = ?",
    [req.params.id, req.session.user.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      if (result.length) {
        res.send(result[0]);
      } else {
        res.send();
      }
    }
  );
}

       function addTask(req, res) {
  con.query(
    "INSERT INTO `tasks`(`task`, `status`, `userId`) VALUES (?, 0, ?)",
    [req.body.task, req.session.user.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      con.query(
        "SELECT * FROM `tasks` WHERE `id` = ?",
        [result.insertId],
        (err, result) => {
          if (err) {
            _1c7‍.g.console.log(err);
          }

          res.send(result[0]);
        }
      );
    }
  );
}

       function changeTaskStatus(req, res) {
  con.query(
    "UPDATE `tasks` SET `status` = ? WHERE `id` = ? AND `userId` = ?",
    [req.params.newStatus, req.params.taskId, req.session.user.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      res.send();
    }
  );
}

       function changeTaskLevel(req, res) {
  con.query(
    "UPDATE `tasks` SET `level` = ? WHERE `id` = ? AND `userId` = ?",
    [req.params.newLevel, req.params.taskId, req.session.user.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      res.send();
    }
  );
}

       function restoreTask(req, res) {
  con.query(
    "UPDATE `tasks` SET `isDeleted` = 0 WHERE `id` = ? AND `userId` = ?",
    [req.params.id, req.session.user.id],
    (err, result) => {
      if (err) {
        _1c7‍.g.console.log(err);
      }

      res.send();
    }
  );
}

// still working on this function

/*export function givePermissions(req, res) {
  console.log(req.body);
  con.query(
    "UPDATE `users` SET  `isadmin` = ? WHERE `id` = ?",[req.body.id],
    (err, result) => {
      if (err) {
        console.log(err);
      }
      res.send();
    }
  );
}*/






